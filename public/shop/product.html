<!doctype html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>Product</title><link rel='stylesheet' href='assets/shop.css'></head><body>
<div class='app'><div id='header'></div><div id='body'></div><div class='card'><h3>Reviews</h3><div id='reviews'></div><div id='reviewForm'></div></div></div><div id='toast' class='toast'></div><div id='bottomNav'></div>
<script src='assets/api.js'></script><script src='assets/cart.js'></script><script src='assets/app.js'></script><script>
renderHeader('Product Detail');renderBottomNav('home');const id=qsi('id');load();
async function load(){const bodyEl=document.getElementById('body');try{const d=await api.get(`/api/products/${id}`);const p=d.product||{};const v=(d.variants||[])[0];const img=(d.images_general||[])[0]?.url||'';const card=document.createElement('div');card.className='card';const image=document.createElement('img');image.className='product-img';image.src=img;const name=document.createElement('h3');setText(name,p.name);const detail=document.createElement('div');setText(detail,p.detail||p.description||'');const price=document.createElement('div');price.style.margin='8px 0';setText(price,`ราคา ${formatMoney(v?.price||0)}`);const addBtn=document.createElement('button');addBtn.className='btn btn-primary';addBtn.id='addBtn';setText(addBtn,'ใส่ตะกร้า');addBtn.onclick=()=>{if(!v){showToast('สินค้านี้ยังไม่มีตัวเลือกขาย','error');return;}cartStore.addItem({product_id:p.id,variant_id:v.id,name:p.name,variant_name:Object.values(v.options||{}).join('/'),price:Number(v.price),qty:1,image_url:img});showToast('เพิ่มลงตะกร้าแล้ว','success');};card.replaceChildren(image,name,detail,price,addBtn);bodyEl.replaceChildren(card);await loadReviews();if(shopSettings.getToken())renderReviewForm();}catch(e){const err=document.createElement('div');err.className='error';setText(err,e.message);bodyEl.replaceChildren(err)}}
async function loadReviews(){const reviewsEl=document.getElementById('reviews');try{const r=await api.get(`/api/products/${id}/reviews`);const items=r.items||[];if(!items.length){setText(reviewsEl,'ยังไม่มีรีวิว');return;}const cards=items.map(x=>{const card=document.createElement('div');card.className='card';const author=document.createElement('b');setText(author,x.user_name);const rating=document.createElement('span');setText(rating,` ⭐${x.rating}`);const title=document.createElement('div');setText(title,x.title||'');const body=document.createElement('div');body.style.whiteSpace='pre-wrap';setText(body,x.body||'');card.append(author,rating,title,body);return card;});reviewsEl.replaceChildren(...cards);}catch(e){setText(reviewsEl,e.message)}}
function renderReviewForm(){document.getElementById('reviewForm').innerHTML=`<h4>เขียนรีวิว</h4><input id='rating' class='input' type='number' min='1' max='5' value='5'><input id='title' class='input' placeholder='หัวข้อ'><textarea id='bodyText' class='input' placeholder='รายละเอียด'></textarea><button id='sendReview' class='btn btn-primary'>ส่งรีวิว</button>`;document.getElementById('sendReview').onclick=async()=>{try{await api.post(`/api/products/${id}/reviews`,{rating:+rating.value,title:title.value,body:bodyText.value});showToast('ส่งรีวิวแล้ว','success');loadReviews()}catch(e){showToast(e.message,'error')}}}
</script></body></html>
