<!doctype html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>Product</title><link rel='stylesheet' href='assets/shop.css'></head><body>
<div class='app'><div id='header'></div><div id='body'></div><div class='card'><h3>Reviews</h3><div id='reviews'></div><div id='reviewForm'></div></div></div><div id='toast' class='toast'></div><div id='bottomNav'></div>
<script src='assets/api.js'></script><script src='assets/cart.js'></script><script src='assets/app.js'></script><script>
renderHeader('Product Detail');renderBottomNav('home');const id=qsi('id');load();
async function load(){try{const d=await api.get(`/api/products/${id}`);const p=d.product;const v=(d.variants||[])[0];const img=(d.images_general||[])[0]?.url||'';document.getElementById('body').innerHTML=`<div class='card'><img class='product-img' src='${img}'><h3>${p.name}</h3><div>${p.detail||p.description||''}</div><div style='margin:8px 0'>ราคา ${formatMoney(v?.price||0)}</div><button class='btn btn-primary' id='addBtn'>ใส่ตะกร้า</button></div>`;document.getElementById('addBtn').onclick=()=>{if(!v){showToast('สินค้านี้ยังไม่มีตัวเลือกขาย','error');return;}cartStore.addItem({product_id:p.id,variant_id:v.id,name:p.name,variant_name:Object.values(v.options||{}).join('/'),price:Number(v.price),qty:1,image_url:img});showToast('เพิ่มลงตะกร้าแล้ว','success');};await loadReviews();if(shopSettings.getToken())renderReviewForm();}catch(e){document.getElementById('body').innerHTML=`<div class='error'>${e.message}</div>`}}
async function loadReviews(){try{const r=await api.get(`/api/products/${id}/reviews`);document.getElementById('reviews').innerHTML=(r.items||[]).map(x=>`<div class='card'><b>${x.user_name}</b> ⭐${x.rating}<div>${x.title||''}</div><div>${x.body||''}</div></div>`).join('')||'ยังไม่มีรีวิว';}catch(e){document.getElementById('reviews').textContent=e.message}}
function renderReviewForm(){document.getElementById('reviewForm').innerHTML=`<h4>เขียนรีวิว</h4><input id='rating' class='input' type='number' min='1' max='5' value='5'><input id='title' class='input' placeholder='หัวข้อ'><textarea id='bodyText' class='input' placeholder='รายละเอียด'></textarea><button id='sendReview' class='btn btn-primary'>ส่งรีวิว</button>`;document.getElementById('sendReview').onclick=async()=>{try{await api.post(`/api/products/${id}/reviews`,{rating:+rating.value,title:title.value,body:bodyText.value});showToast('ส่งรีวิวแล้ว','success');loadReviews()}catch(e){showToast(e.message,'error')}}}
</script></body></html>
